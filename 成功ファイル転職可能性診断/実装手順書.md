# 転職可能性診断 LINE連携 実装手順書

## 1. 必要なもの

- WordPress サイト（`/column/` ディレクトリ）
- LINE Developers アカウント
- L-step アカウント（LINE登録URL発行用）

## 2. LIFF設定

### 2.1 LINE Login チャネルの確認
1. LINE Developers Console (https://developers.line.biz/)
2. よりそい転職のプロバイダー → LINE Login チャネル

### 2.2 LIFFアプリの追加
1. LINE Login チャネル内 → 「LIFF」タブ
2. 「追加」ボタン
3. 設定内容：
   - LIFFアプリ名：`転職可能性診断`
   - サイズ：`Full`
   - エンドポイントURL：`https://migi-nanameue.co.jp/column/wp-content/uploads/2026/01/career-probability-unified.html`
   - Scope：`profile`
   - ボットリンク機能：`Off`

4. 作成後、**LIFF ID** をコピー

### 2.3 URL許可リスト設定
1. LIFFアプリの詳細設定
2. 「リンク先URL許可リスト」に以下を追加：
   - `https://migi-nanameue.co.jp`

## 3. L-step設定

1. L-stepでLINE登録用URLを発行
2. 転職可能性診断用のリダイレクト設定を作成
3. 発行されたURL（例：`https://liff.line.me/xxx/landing?follow=xxx&lp=xxx&liff_id=xxx`）をコピー

## 4. HTMLファイルの設定

`career-probability-unified.html` を開き、以下を変更：

```javascript
// LIFF設定（★新規LIFF作成後に設定★）
const LIFF_ID = 'YOUR_LIFF_ID_HERE';  // ← 2.2で取得したLIFF IDに変更

// LINE登録URL（★L-stepから取得後に設定★）
const LINE_REGISTRATION_BASE_URL = 'YOUR_LINE_REGISTRATION_URL_HERE';  // ← 3で取得したURLに変更
```

## 5. WordPressプラグインのインストール

1. WordPress管理画面 → プラグイン → 新規追加
2. 「プラグインのアップロード」→ `career-probability-api-plugin.zip` を選択
3. 「今すぐインストール」→「有効化」
4. **重要**: 設定 → パーマリンク → 「変更を保存」をクリック（REST API有効化）

## 6. HTMLファイルのアップロード

1. WordPress管理画面 → メディア → 新規追加
2. `career-probability-unified.html` をアップロード
3. アップロード後のURLを確認（例：`https://migi-nanameue.co.jp/column/wp-content/uploads/2026/01/career-probability-unified.html`）
4. このURLが「2.2 エンドポイントURL」と一致していることを確認

## 7. 動作確認

1. アップロードしたHTMLのURLにアクセス
2. 診断を最後まで完了
3. LINE登録画面が表示されることを確認
4. LINE登録後、結果が表示されることを確認
5. WordPressダッシュボード → 転職可能性診断 でデータが表示されることを確認

## 8. トラブルシューティング

### 404エラーが出る
- パーマリンクを再保存（設定 → パーマリンク → 変更を保存）
- `WP_API_BASE` のURLを確認（`/column/` が含まれているか）

### 結果が表示されない
- ブラウザのコンソールでエラーを確認
- `?debug` パラメータを付けてアクセス
- LIFF IDが正しく設定されているか確認

### ダッシュボードにデータが出ない
- LINE登録後に結果を見たか確認
- プラグインが有効化されているか確認


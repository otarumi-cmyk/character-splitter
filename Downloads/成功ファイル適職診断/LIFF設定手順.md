# LIFF設定手順 - LIFFタブが見つからない場合

## 🔍 問題の原因

LIFFタブは、**Messaging APIチャネルの中**にあります。
現在表示されている画面は「チャネルタイプの選択画面」なので、まず**Messaging APIチャネルを作成または選択**する必要があります。

---

## 📋 解決手順

### ステップ1: Messaging APIチャネルを作成または選択

現在の画面で、以下のいずれかを実行してください：

#### パターンA: 既存のMessaging APIチャネルがある場合

1. 画面中央の4つのアイコンから **「Messaging API」** をクリック
2. 既存のMessaging APIチャネルが表示されるので、該当するチャネルを選択

#### パターンB: 新しいMessaging APIチャネルを作成する場合

1. 画面中央の4つのアイコンから **「Messaging API」** をクリック
2. 「チャネルを作成」または「新規作成」ボタンをクリック
3. チャネル情報を入力：
   - **チャネル名**: 適職診断ツール（任意の名前）
   - **チャネル説明**: 適職診断ツール用（任意）
   - **大業種**: 選択
   - **小業種**: 選択
   - **メールアドレス**: 連絡先メールアドレス
4. 「作成」をクリック

### ステップ2: Messaging APIチャネルの設定画面を開く

Messaging APIチャネルを選択または作成すると、チャネルの設定画面が表示されます。

**左側のメニューに以下のタブが表示されます：**
- 基本設定
- **LIFF** ← これが目的のタブです！
- Webhook設定
- Messaging API設定
- その他

### ステップ3: LIFFタブを開く

左側のメニューから **「LIFF」** をクリックします。

### ステップ4: LIFFアプリを作成

LIFFタブを開くと、以下のいずれかが表示されます：

#### パターンA: 既存のLIFFアプリがある場合

- 既存のLIFFアプリ一覧が表示されます
- 既存のLIFFアプリを使用する場合は、そのLIFFアプリIDをメモします
- 新しいLIFFアプリを作成する場合は「追加」ボタンをクリック

#### パターンB: LIFFアプリがない場合

- 「追加」または「新規作成」ボタンをクリック

### ステップ5: LIFFアプリの設定

LIFFアプリを作成する際に、以下の情報を入力します：

1. **LIFFアプリ名**: 適職診断ツール（任意の名前）

2. **サイズ**: 
   - **Full** を選択（推奨）
   - または **Tall** を選択

3. **エンドポイントURL**: 
   ```
   https://agent.migi-nanameue.co.jp/diagnosis.html
   ```
   - 実際の診断ツールのURLを入力
   - **重要**: `https://` で始まるURLである必要があります

4. **スコープ**: 
   - **profile** にチェック（lineUserIdを取得するために必要）
   - **openid** にチェック（オプション）

5. **Bot link feature**: 
   - 必要に応じて設定（通常はそのままでOK）

6. 「追加」または「作成」をクリック

### ステップ6: LIFFアプリIDを確認

LIFFアプリを作成すると、**LIFFアプリID**が表示されます。

**例:**
```
1657698499-9xjEMXXe
```

このLIFFアプリIDをメモします。

### ステップ7: diagnosis.htmlにLIFFアプリIDを設定

`diagnosis.html` の1208行目付近を開き、LIFFアプリIDを設定します：

```javascript
const LIFF_ID = '1657698499-9xjEMXXe'; // 実際のLIFFアプリIDに置き換える
```

**例:**
```javascript
const LIFF_ID = '1234567890-abcdefgh'; // ステップ6で取得したLIFFアプリID
```

### ステップ8: URL許可リストの確認（重要）

LIFFアプリの設定画面で、**「URL許可リスト」**または**「Allowed URLs」**を確認します。

**確認項目:**
- 診断ツールのURL（`https://agent.migi-nanameue.co.jp/diagnosis.html`）が許可リストに含まれているか確認
- 含まれていない場合は、追加する必要があります

**URL許可リストの設定方法:**
1. LIFFアプリの設定画面を開く
2. 「URL許可リスト」または「Allowed URLs」セクションを探す
3. 診断ツールのURLを追加:
   ```
   https://agent.migi-nanameue.co.jp/diagnosis.html
   ```
4. 「保存」をクリック

---

## 🔧 トラブルシューティング

### LIFFタブが表示されない場合

**確認事項:**
1. **Messaging APIチャネルを選択しているか確認**
   - チャネルタイプの選択画面ではなく、Messaging APIチャネルの設定画面にいる必要があります
2. **チャネルタイプが正しいか確認**
   - Messaging APIチャネルである必要があります
   - LINE Loginチャネルやその他のチャネルタイプではLIFFタブは表示されません
3. **権限を確認**
   - チャネルの管理者権限があるか確認

**対処法:**
1. 一度チャネル設定のトップページに戻る
2. 「Messaging API」を選択
3. 既存のMessaging APIチャネルを選択するか、新規作成する

### LIFFアプリを作成できない場合

**確認事項:**
1. **エンドポイントURLが正しいか確認**
   - `https://` で始まっているか
   - 実際にアクセスできるURLか
2. **URL許可リストに追加されているか確認**
   - エンドポイントURLが許可リストに含まれている必要があります

**対処法:**
1. エンドポイントURLを `https://` で始まる完全なURLに変更
2. URL許可リストにエンドポイントURLを追加
3. 再度LIFFアプリを作成を試みる

### LIFFアプリIDが取得できない場合

**確認事項:**
1. LIFFアプリが正しく作成されているか確認
2. LIFFタブでLIFFアプリ一覧が表示されているか確認

**対処法:**
1. LIFFタブを開く
2. LIFFアプリ一覧を確認
3. LIFFアプリIDをコピー（通常は「アプリID」または「LIFF ID」と表示されています）

---

## 📝 チェックリスト

LIFF設定が完了したら、以下を確認してください：

- [ ] Messaging APIチャネルを作成または選択した
- [ ] LIFFタブが表示された
- [ ] LIFFアプリを作成した
- [ ] LIFFアプリIDを取得した
- [ ] `diagnosis.html` の `LIFF_ID` にLIFFアプリIDを設定した
- [ ] URL許可リストに診断ツールのURLを追加した
- [ ] エンドポイントURLが `https://` で始まっている

---

## 🎯 次のステップ

LIFF設定が完了したら、以下を実行してください：

1. **LIFF URLを確認**
   - LIFFアプリの設定画面で、LIFF URLが表示されます
   - 例: `https://liff.line.me/1657698499-9xjEMXXe`
   
2. **動作確認**
   - LIFF URLをブラウザで開く
   - 開発者ツール（F12）のConsoleタブを開く
   - `typeof liff` を実行 → `"object"` が返ればOK

3. **実装手順書の次のステップに進む**
   - `実装手順書.md` のステップ8以降を実行

---

## 📞 参考資料

- [LINE Developers Console](https://developers.line.biz/console/)
- [LIFF ドキュメント](https://developers.line.biz/ja/docs/liff/)
- `実装手順書.md`: 実装の詳細手順
- `実装内容まとめ.md`: 実装の詳細仕様

